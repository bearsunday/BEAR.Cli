#!/usr/bin/env php
<?php

declare(strict_types=1);

use BEAR\AppMeta\Meta;
use BEAR\Cli\CompileScript;
use BEAR\Cli\GenScript;

require dirname(__DIR__, 4) . '/vendor/autoload.php';

if ($argc < 2) {
    echo 'Usage: bear-cli-gen <app-name>' . PHP_EOL;
    echo '  e.g. bear-cli-gen MyVendor\MyApp' . PHP_EOL;
    exit(1);
}

$appName = $argv[1];
try {
    $meta = new Meta($appName);
    $compiler = new CompileScript(new GenScript());
    $sources = $compiler->compile($meta);

    echo sprintf('CLI commands have been generated in %s:', $meta->appDir . '/bin') . PHP_EOL;
    foreach ($sources as $source) {
        echo sprintf('  %s', $source->name) . PHP_EOL;
    }
    exit(0);
} catch (\Exception $e) {
    echo 'Error: ' . $e->getMessage() . PHP_EOL;
    exit(1);
}
